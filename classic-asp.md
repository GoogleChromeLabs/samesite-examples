# Classic ASP (ASP 3) example for `SameSite=None; Secure`

Classic ASP (not to be confused with [ASP.NET](aspnet.md)) latest platform release dates form 2003. The `SameSite` and `HttpOnly` Flags were unknown at this time. They were introduced to the web ecosystem years after. Consequently, these Flags are not present in the two types of cookies that can be generated by the Classic ASP platform, namely:

- [Classic ASP Session Cookies](#classic-asp-session-cookies),
- [Code-defined Cookies](#code-defined-cookies).

This guide explain how to add these two `SameSite` and `HttpOnly` Flags to cookies generated by the Classic ASP platform, in order to comply with the latest browsers security requirements, and participate into elevating the whole WWW ecosystem security.

SIDE-NOTE: Classic ASP scripts are still perfectly running on modern IIS Internet Information Services versions (up to Windows Server 2022 at the time of writing)
(see this [Microsoft official statement](https://docs.microsoft.com/en-us/troubleshoot/developer/webapps/iis/general/asp-support-windows)).

## Classic ASP Session Cookies

If the IIS website is configured to handle and maintain server-side sessions, a Session Cookie is automatically generated by IIS and sent along with every response by IIS.

These cookies have the following syntax (regex): `ASPSESSIONID([A-Z]{8})=([A-Z]{24}); secure; path=/`. They have the `secure` Flag by default.

To add the `SameSite` and `HttpOnly` Flags to these cookies, simply add the following rule in the root-level **web.config** file of your IIS website:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<system.webServer>
		<rewrite>
			<outboundRules>
				<!-- Add Flags to Classic ASP Session Cookies -->
				<rule name="Add Flags to Classic ASP Session Cookies" patternSyntax="ECMAScript">
					<match serverVariable="RESPONSE_Set_Cookie" pattern="ASPSESSIONID([A-Z]{8})=([A-Z]{24}); secure; path=/" ignoreCase="true" negate="false" />
					<action type="Rewrite" value="{R:0}; SameSite=None; HttpOnly" />
				</rule>
			</outboundRules>
		</rewrite>
	</system.webServer>
</configuration>
```



## Code-defined Cookies

Custom Cookies can be defined in a Classic ASP server-side script, and sent by IIS along with the response. Such Custom Cookies can be defined this way:

```asp
<%
Response.Cookies("exampleCookie") = "Your Cookie Content goes here"
Response.Cookies("exampleCookie").Path = "/"
Response.Cookies("exampleCookie").Secure = True
'Now, note that the two following attributes DO NOT EXIST! Code will fail if you uncomment these lines.
'Response.Cookies("exampleCookie").HttpOnly = True
'Response.Cookies("exampleCookie").SameSite = "None"
%>
```

As the `HttpOnly`and `SameSite` Attributes do not exist in the Classic ASP platform (cf. [Official Microsoft Documentation](https://docs.microsoft.com/en-us/previous-versions/iis/6.0-sdk/ms524757(v=vs.90))), you cannot rely on using the `Response.Cookies` object to define your custom cookies.
Instead, you need to define them by using the `Response.AddHeader` method like in the following example:

```asp
<%
'Return a cookie, allowed to be used by CLIENT-SIDE browser Javascript engine (so let's omit `HttpOnly`)
Response.AddHeader "Set-Cookie", "exampleCookie=Your+Cookie+Content+goes+here; path=/; SameSite=None; Secure"

'Return a cookie, intended to be exclusively used SERVER-SIDE (so let's include `HttpOnly`)
Response.AddHeader "Set-Cookie", "exampleCookie=Your+Cookie+Content+goes+here; path=/; SameSite=None; Secure; HttpOnly"
%>
```

You can obviously set the value of the `SameSite` Flag to any valid value you want: `None`, `Lax`, `Strict`. Wether you are editing the **web.config** file, or a Classic ASP script (\*.asp), the syntax is case-insensitive.

